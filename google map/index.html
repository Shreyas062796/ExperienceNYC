<!DOCTYPE html>

<html>
	<head>
		<title>Google Maps</title>
	</head>
	<style>
		#map{
			height: 400px;
			width: 100%
		}
	</style>
	
	<body>
	
		<h1>Google Map</h1>
		
		<div id = "map"></div>
		
		<script>	
			function clearTrip(){
				trip = [];
				var listboxTrips = document.getElementById("listboxTrips")
				
				listboxTrips.options.length = 0
			}
		
			function resize(map, width, height){
				var mapDiv = document.getElementById('map')
				mapDiv.style.width = String(100 * width) + '%';
				mapDiv.style.height = String(400 * height) + 'px';
				
				
				
				
				google.maps.event.trigger(map, "resize");
			}
		
			var count = 1;
			//map locations
			var markers = []
			
			//trips
			var trip = []
			
			function initMap(){				
				//map properties
				var options = {
					zoom : 8,
					center : {lat: 42.3601, lng: -71.0589},					
				}
				
				//new map
				var map = new google.maps.Map(document.getElementById('map'), options);				
				
				var slider = document.getElementById("myRange");
				var wid = document.getElementById("width");
				var len = document.getElementById("len");
				
				slider.onmouseup = function() {
					resize(map, this.value / 100, this.value/ 100)
				}

				//directions
				var dirDisp = new google.maps.DirectionsRenderer();
				var dirServ = new google.maps.DirectionsService();

				dirDisp.setMap(map);
				
				var directions = document.getElementById('directions');
			
				directions.addEventListener('click', function(){
				
					
				
					//var start = new google.maps.LatLng(42.1, -71.2);
					
					//console.log(markers[0].getPosition().lng())
					
					var start = {					
						lat: markers[trip[0]].getPosition().lat(), 
						lng: markers[trip[0]].getPosition().lng()
					}
					
					//var end = new google.maps.LatLng(42.7, -71.8);
					
					var end = {					
						lat: markers[trip[trip.length - 1]].getPosition().lat(), 
						lng: markers[trip[trip.length - 1]].getPosition().lng()
					}
					
					
					
					var request = {
						origin: start,
						destination: end,
						travelMode: 'DRIVING'
					};
					
					dirServ.route(request, function(result, status){
						console.log(result, status);
						if (status == 'OK'){
							dirDisp.setDirections(result);
						}
					});
				});

				
				
				
				/*
				//map marker
				var marker = new google.maps.Marker({
					position: {lat : 42.4668, lng : -70.9495},
					map : map
				});
				
				
				
				marker.addListener('click', function(){
					info.open(map, marker)
					alert("HI")
				})
				
				var markers = [
					{lat : 42.4668, lng : -70.9495},
					{lat : 42.8584, lng : -70.9300},
					{lat : 42.7762, lng : -71.0773}
				]
				
				
				
				for(var i = 0; i < markers.length; i++){
					
				}
				*/
				
				
				//addMarker({lat: 42.4668, lng: -70.9495})
				
				var listbox = document.getElementById("listbox")
				var listboxTrips = document.getElementById("listboxTrips")
				
				function addMarker(coords){
					var marker = new google.maps.Marker({
						position: coords,
						map: map
					});			
					
					return marker;
				}
				
								
				//add location
				var addLoc = document.getElementById('addLoc');		
				addLoc.addEventListener('click', function(){
					//locals, read from slected index in locations
					var lat = (Math.random() + 42);					
					var lng = (Math.random() + 70) * -1;
					
					var marker = addMarker({lat: lat, lng: lng});
					var content = 'Location ' + count + ", Lat: " + lat + " Lng: " + lng;
					
					var InfoWindowOpened = false;
					var markerOpened = false;
					
					var infoWind = new google.maps.InfoWindow({
						content: content
					})
					
					//handle marker events
					marker.addListener('click', function(){	
						if (InfoWindowOpened == false){
							infoWind.open(map, marker)
							InfoWindowOpened = true;
						}else{
							infoWind.close()
							InfoWindowOpened = false;
						}
					})
					
					marker.addListener('blur', function(){
						infoWind.close()
					})
					
					//handle listbox events
					var option = document.createElement('option');				
					option.id = content
					option.text = content					
					listbox.options.add(option)
					
					markers.push(marker)
					
					option.addEventListener('click', function(){			
						if (InfoWindowOpened == false){
							infoWind.open(map, marker)
							InfoWindowOpened = true;
						}else{
							infoWind.close()
							InfoWindowOpened = false;
						}
						if (markerOpened == false){
							marker.setMap(map);
							markerOpened = true;
						}else{
							marker.setMap(null);
							markerOpened = false;
						}
					})
					
					count += 1;
				});
				
				
				//add Location to Trip
				
				var addLocToTrip = document.getElementById('addLocToTrip');
				addLocToTrip.addEventListener('click', function(){
					//handle listbox events
					var option = document.createElement('option');

					
					option.id = 'item'
					option.text = listbox.selectedIndex
					
					
					trip.push(listbox.selectedIndex)
					
					
					console.log(markers[listbox.selectedIndex].getPosition().lat());
					
					listboxTrips.options.add(option)
				});
			}
			
			
			
			
		</script>
		
		<script async defer src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyDY9sPjqTuCmSf3Ah7ENRxW0sTF0cZ7b8w&callback=initMap">
		</script>
		
		<!-- Map Dimensions -->		
		<div> 
			<h2>Map Dimensions</h2>
			<div class="slidecontainer">
				<input type="range" min="1" max="100" value="100" class="slider" id="myRange" onmouseup = "alert('hey')">
			</div>
		
		</div>
		
		<!-- Add locations 
		
		<h2>Locations</h2>
		
		<select multiple id = "listboxTrips" name="listbox" size="8">
		</select>
		</br>
		<button id = "addLoc" type = "button"> Add Location</button>	
			
		</br>
		-->
		
		
		<!-- Add locations-->
		<h2>Locations</h2>
		
		<select multiple id = "listbox" name="listbox" size="8">
		</select>
		
		</br>
		<button id = "addLoc" type = "button"> Add Location</button> 
		</br>
		
		
		
		<!-- Add to Trip -->
		<h2>Trip</h2>
		<select multiple id = "listboxTrips" name="listboxTrips" size="8">
		</select>
		
		</br>
		<button id = "addLocToTrip" type = "button"> Add Location to Trip</button> 
		
		<!-- Clear -->
		<button id = "clearButton" onclick = "clearTrip()"> Clear Trip </button>
		
		<!-- Directions -->
		<button id = "directions" type = "button"> Directions  </button>
		
	</body>
</html>